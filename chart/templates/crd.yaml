apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: gpurequests.tgp.io
  labels:
    {{- include "tgp-operator.labels" . | nindent 4 }}
spec:
  group: tgp.io
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                provider:
                  type: string
                  description: GPU provider (vast.ai, runpod, lambda-labs, paperspace). If empty, cheapest will be selected.
                gpuType:
                  type: string
                  description: GPU type (e.g., RTX3090, RTX4090, A100)
                region:
                  type: string
                  description: Deployment region
                talosConfig:
                  type: object
                  properties:
                    image:
                      type: string
                      description: Talos Linux image URL
                    wireGuardConfig:
                      type: object
                      properties:
                        privateKey:
                          type: string
                        publicKey:
                          type: string
                        serverEndpoint:
                          type: string
                        allowedIPs:
                          type: array
                          items:
                            type: string
                        address:
                          type: string
                      required:
                        - privateKey
                        - publicKey
                        - serverEndpoint
                        - allowedIPs
                        - address
                  required:
                    - image
                    - wireGuardConfig
              required:
                - gpuType
                - talosConfig
            status:
              type: object
              properties:
                phase:
                  type: string
                  enum:
                    - Pending
                    - Provisioning
                    - Booting
                    - Joining
                    - Ready
                    - Terminating
                    - Failed
                message:
                  type: string
                instanceID:
                  type: string
                nodeName:
                  type: string
                providerInfo:
                  type: object
                  additionalProperties: true
  scope: Namespaced
  names:
    plural: gpurequests
    singular: gpurequest
    kind: GPURequest