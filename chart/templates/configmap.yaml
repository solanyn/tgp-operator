{{- if .Values.config }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "tgp-operator.fullname" . }}-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "tgp-operator.labels" . | nindent 4 }}
data:
  config.yaml: |
    providers:
      vultr:
        enabled: {{ .Values.config.providers.vultr.enabled | default false }}
        credentialsRef:
          name: {{ .Values.config.providers.vultr.credentialsRef.name | default "tgp-operator-secret" }}
          {{- if .Values.config.providers.vultr.credentialsRef.namespace }}
          namespace: {{ .Values.config.providers.vultr.credentialsRef.namespace }}
          {{- end }}
          key: {{ .Values.config.providers.vultr.credentialsRef.key | default "VULTR_API_KEY" }}
      gcp:
        enabled: {{ .Values.config.providers.gcp.enabled | default false }}
        credentialsRef:
          name: {{ .Values.config.providers.gcp.credentialsRef.name | default "tgp-operator-secret" }}
          {{- if .Values.config.providers.gcp.credentialsRef.namespace }}
          namespace: {{ .Values.config.providers.gcp.credentialsRef.namespace }}
          {{- end }}
          key: {{ .Values.config.providers.gcp.credentialsRef.key | default "GOOGLE_APPLICATION_CREDENTIALS_JSON" }}
    talos:
      image: {{ .Values.config.talos.image | default "ghcr.io/siderolabs/talos:v1.10.5" }}
    tailscale:
      tags:
        {{- range .Values.config.tailscale.tags | default (list "tag:k8s" "tag:gpu") }}
        - {{ . | quote }}
        {{- end }}
      ephemeral: {{ .Values.config.tailscale.ephemeral | default true }}
      acceptRoutes: {{ .Values.config.tailscale.acceptRoutes | default true }}
      oauthCredentialsRef:
        name: {{ .Values.config.tailscale.oauthCredentialsRef.name | default "tgp-operator-secret" }}
        {{- if .Values.config.tailscale.oauthCredentialsRef.namespace }}
        namespace: {{ .Values.config.tailscale.oauthCredentialsRef.namespace }}
        {{- end }}
        clientIdKey: {{ .Values.config.tailscale.oauthCredentialsRef.clientIdKey | default "client-id" }}
        clientSecretKey: {{ .Values.config.tailscale.oauthCredentialsRef.clientSecretKey | default "client-secret" }}
{{- end }}